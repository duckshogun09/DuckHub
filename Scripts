local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
	Name = "Duck Hub - Type: Script Menu",
	LoadingTitle = "Loading...",
	LoadingSubtitle = "by Duck",
	ConfigurationSaving = { Enabled = false },
	KeySystem = false
})

local HomeTab = Window:CreateTab("Home")

local message = game:HttpGet("https://raw.githubusercontent.com/duckshogun09/DuckHub/refs/heads/main/notice.txt")
HomeTab:CreateParagraph({
	Title = "Latest Announcement",
	Content = message
})

HomeTab:CreateLabel("Version: 1.0.0")

HomeTab:CreateButton({
	Name = "Join Discord",
	Callback = function()
		setclipboard("discord.gg/NF6fZapa3U")
		Rayfield:Notify({
			Title = "Discord",
			Content = "Discord link copied!",
			Duration = 4,
			Image = 6031075938
		})
	end,
})

HomeTab:CreateParagraph({
	Title = "Supported Games",
	Content = table.concat({
		"• Grow A Garden",
		"• Blox Fruits",
		"• Arise Crossover",
		"• King Legacy"
	}, "\n")
})


local ScriptTab = Window:CreateTab("Scripts")

local scriptsByPlaceId = {
	[126884695634066] = {
		["Speed Hub X"] = [[
			loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", true))()
		]],
		["No Lag Hub"] = [[
			loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/NoLag-id/No-Lag-HUB/refs/heads/main/Loader/LoaderV1.lua"))()
		]]
	},
	[2753915549] = {
		["Speed Hub X"] = [[
			loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", true))()
		]]
	},
	[1234567890] = {
		["Script A"] = [[
			print("Đây là Script A cho game thứ 3")
		]],
		["Script B"] = [[
			print("Đây là Script B cho game thứ 3")
		]]
	}
}

local scripts = scriptsByPlaceId[game.PlaceId]

if scripts then
	for name, code in pairs(scripts) do
		ScriptTab:CreateButton({
			Name = name,
			Callback = function()
				loadstring(code)()
			end,
		})
	end
else
	ScriptTab:CreateParagraph({
		Title = "Notification",
		Content = "Scripts are not available for the current game. See what games the script supports in the Home tab."
	})
end

local ServerTab = Window:CreateTab("Server")

-- Hiển thị số người chơi
local playerCountLabel = ServerTab:CreateLabel("Players in the server: " .. tostring(#game.Players:GetPlayers()))

game.Players.PlayerAdded:Connect(function()
	playerCountLabel:Set("Players in the server: " .. tostring(#game.Players:GetPlayers()))
end)

game.Players.PlayerRemoving:Connect(function()
	task.wait(0.5)
	playerCountLabel:Set("Players in the server: " .. tostring(#game.Players:GetPlayers()))
end)

-- Dịch vụ
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local PlaceID = game.PlaceId

-- Khởi tạo file và dữ liệu nhớ server đã từng join
local AllIDs = {}
local foundAnything = ""
local actualHour = os.date("!*t").hour

local File = pcall(function()
	AllIDs = HttpService:JSONDecode(readfile("NotSameServers.json"))
end)

if not File then
	table.insert(AllIDs, actualHour)
	writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
end

-- Hàm tìm server mới để teleport (tránh server đã join)
local function TPReturner()
	local Site
	if foundAnything == "" then
		Site = HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100'))
	else
		Site = HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100&cursor=' .. foundAnything))
	end

	if Site.nextPageCursor and Site.nextPageCursor ~= "null" and Site.nextPageCursor ~= nil then
		foundAnything = Site.nextPageCursor
	else
		foundAnything = ""
	end

	local num = 0
	for i,v in pairs(Site.data) do
		local Possible = true
		local ID = tostring(v.id)

		if tonumber(v.maxPlayers) > tonumber(v.playing) then
			for _,Existing in pairs(AllIDs) do
				if num ~= 0 then
					if ID == tostring(Existing) then
						Possible = false
						break
					end
				else
					if tonumber(actualHour) ~= tonumber(Existing) then
						local delFile = pcall(function()
							delfile("NotSameServers.json")
							AllIDs = {}
							table.insert(AllIDs, actualHour)
						end)
					end
				end
				num = num + 1
			end
			if Possible then
				table.insert(AllIDs, ID)
				pcall(function()
					writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
					TeleportService:TeleportToPlaceInstance(PlaceID, ID, Players.LocalPlayer)
				end)
				wait(4)
				break
			end
		end
	end
end

-- Vòng lặp tự động hop server
local teleporting = false

local function StartTeleportLoop()
	if teleporting then return end
	teleporting = true

	task.spawn(function()
		while teleporting do
			pcall(function()
				TPReturner()
				if foundAnything ~= "" then
					TPReturner()
				end
			end)
			task.wait(5)
		end
	end)
end

local function StopTeleportLoop()
	teleporting = false
end

-- Nút bắt đầu auto hop server
ServerTab:CreateButton({
	Name = "Start Auto Hop Server (avoid old servers)",
	Callback = function()
		Rayfield:Notify({
			Title = "Server Hop",
			Content = "Started auto hop to new servers!",
			Duration = 4
		})
		StartTeleportLoop()
	end,
})

-- Nút dừng auto hop server
ServerTab:CreateButton({
	Name = "Stop Auto Hop Server",
	Callback = function()
		StopTeleportLoop()
		Rayfield:Notify({
			Title = "Server Hop",
			Content = "Stopped auto hop.",
			Duration = 4
		})
	end,
})

-- Nút hop thủ công một lần theo logic mới
ServerTab:CreateButton({
	Name = "Hop Server Once (avoid old servers)",
	Callback = function()
		pcall(function()
			TPReturner()
			if foundAnything ~= "" then
				TPReturner()
			end
		end)
	end,
})

-- Input JobId để join server bất kỳ
ServerTab:CreateInput({
	Name = "Join Server by JobId",
	PlaceholderText = "Paste JobId here",
	RemoveTextAfterFocusLost = false,
	Callback = function(jobId)
		TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, Players.LocalPlayer)
	end
})

-- Nút copy JobId hiện tại
ServerTab:CreateButton({
	Name = "Copy current JobId",
	Callback = function()
		setclipboard(game.JobId)
		Rayfield:Notify({
			Title = "JobId Copied",
			Content = "Copied the JobId of the current server to the clipboard!",
			Duration = 4,
			Image = 6035047409
		})
	end,
})
