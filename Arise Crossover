-- Load Kavo UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()

local Window = Library.CreateLib("Arise Crossover | Hub", "Ocean")

local AutoFarm = false
local SelectedMob = nil
local mobsList = {}
local mobDropdown

-- Tab Farm
local FarmTab = Window:NewTab("Farm")
local FarmSection = FarmTab:NewSection("Farm Mobs")

-- Label Mob đã chọn
local selectedLabel = FarmSection:NewLabel("Mob đã chọn: Không có")

-- Hàm cập nhật dropdown
local function RefreshDropdown()
    if mobDropdown then
        mobDropdown:Clear()
        for _, mobName in ipairs(mobsList) do
            mobDropdown:Add(mobName)
        end
    end
end

-- Hàm thêm mob mới
local function AddMob(mobName)
    if not table.find(mobsList, mobName) then
        table.insert(mobsList, mobName)
        RefreshDropdown()
    end
end

-- Hàm xóa mob khi despawn (optional, mob đã chết hoặc despawn)
local function RemoveMob(mobName)
    for i, name in ipairs(mobsList) do
        if name == mobName then
            table.remove(mobsList, i)
            RefreshDropdown()
            break
        end
    end
end

-- Theo dõi mob mới spawn hoặc despawn
local mobsFolder = workspace:WaitForChild("Mobs")
mobsFolder.ChildAdded:Connect(function(child)
    if child:IsA("Model") and child:FindFirstChild("HumanoidRootPart") then
        AddMob(child.Name)
    end
end)

mobsFolder.ChildRemoved:Connect(function(child)
    if child:IsA("Model") then
        RemoveMob(child.Name)
    end
end)

-- Quét ban đầu khi mở script
for _, mob in pairs(mobsFolder:GetChildren()) do
    if mob:IsA("Model") and mob:FindFirstChild("HumanoidRootPart") then
        AddMob(mob.Name)
    end
end

-- Tạo Dropdown chọn mob
mobDropdown = FarmSection:NewDropdown("Chọn Mob", "Chọn quái để farm", mobsList, function(currentOption)
    SelectedMob = currentOption
    selectedLabel:UpdateLabel("Mob đã chọn: " .. SelectedMob)
    Library:Notify("Mob đã chọn!", "Bạn đã chọn: " .. SelectedMob, 3)
end)

-- Nút teleport tới mob đã chọn
FarmSection:NewButton("Teleport tới Mob", "Dịch chuyển tới mob đã chọn", function()
    local character = game.Players.LocalPlayer.Character
    if character and character:FindFirstChild("HumanoidRootPart") and SelectedMob then
        for _, mob in pairs(mobsFolder:GetChildren()) do
            if mob.Name == SelectedMob and mob:FindFirstChild("HumanoidRootPart") then
                character.HumanoidRootPart.CFrame = mob.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)
                Library:Notify("Dịch chuyển thành công!", "Tới mob: " .. SelectedMob, 3)
                break
            end
        end
    else
        Library:Notify("Lỗi!", "Không tìm thấy mob hoặc chưa chọn!", 3)
    end
end)

-- Toggle Auto Farm
FarmSection:NewToggle("Auto Farm Mob", "Tự động farm mob đã chọn", false, function(state)
    AutoFarm = state
    if AutoFarm then
        AutoFarmFunction()
    end
end)

-- Auto Farm Function
function AutoFarmFunction()
    task.spawn(function()
        while AutoFarm do
            pcall(function()
                local player = game.Players.LocalPlayer
                local character = player.Character

                if mobsFolder and character and character:FindFirstChild("HumanoidRootPart") and SelectedMob then
                    for _, mob in pairs(mobsFolder:GetChildren()) do
                        if mob.Name == SelectedMob and mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
                            character.HumanoidRootPart.CFrame = mob.HumanoidRootPart.CFrame * CFrame.new(0, 0, 3)

                            local args = {[1] = mob}
                            game:GetService("ReplicatedStorage").Remotes.Combat:FireServer(unpack(args))
                            task.wait(0.2)
                        end
                    end
                end
            end)
            task.wait(0.1)
        end
    end)
end
