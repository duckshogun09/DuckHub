local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
	Name = "Duck Hub - Type: Script Menu",
	LoadingTitle = "Loading...",
	LoadingSubtitle = "by Duck",
	ConfigurationSaving = { Enabled = false },
	KeySystem = false
})

local HomeTab = Window:CreateTab("Home")

local message = game:HttpGet("https://raw.githubusercontent.com/duckshogun09/DuckHub/refs/heads/main/notice.txt")
HomeTab:CreateParagraph({
	Title = "Latest Announcement",
	Content = message
})

HomeTab:CreateLabel("Version: 1.0.0")

HomeTab:CreateButton({
	Name = "Join Discord",
	Callback = function()
		setclipboard("discord.gg/NF6fZapa3U")
		Rayfield:Notify({
			Title = "Discord",
			Content = "Discord link copied!",
			Duration = 4,
			Image = 6031075938
		})
	end,
})

HomeTab:CreateParagraph({
	Title = "Supported Games",
	Content = table.concat({
		"• Grow A Garden",
		"• Blox Fruits",
		"• Arise Crossover",
		"• King Legacy"
	}, "\n")
})


local ScriptTab = Window:CreateTab("Scripts")

local scriptsByPlaceId = {
	[126884695634066] = {
		["Speed Hub X"] = [[
			loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", true))()
		]],
		["No Lag Hub"] = [[
			loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/NoLag-id/No-Lag-HUB/refs/heads/main/Loader/LoaderV1.lua"))()
		]]
	},
	[2753915549] = {
		["Speed Hub X"] = [[
			loadstring(game:HttpGet("https://raw.githubusercontent.com/AhmadV99/Speed-Hub-X/main/Speed%20Hub%20X.lua", true))()
		]]
	},
	[1234567890] = {
		["Script A"] = [[
			print("Đây là Script A cho game thứ 3")
		]],
		["Script B"] = [[
			print("Đây là Script B cho game thứ 3")
		]]
	}
}

local scripts = scriptsByPlaceId[game.PlaceId]

if scripts then
	for name, code in pairs(scripts) do
		ScriptTab:CreateButton({
			Name = name,
			Callback = function()
				loadstring(code)()
			end,
		})
	end
else
	ScriptTab:CreateParagraph({
		Title = "Notification",
		Content = "Scripts are not available for the current game. See what games the script supports in the Home tab."
	})
end

local ServerTab = Window:CreateTab("Server")

-- Hiển thị số người chơi
local playerCountLabel = ServerTab:CreateLabel("Players in the server: " .. tostring(#game.Players:GetPlayers()))

game.Players.PlayerAdded:Connect(function()
    playerCountLabel:Set("Players in the server: " .. tostring(#game.Players:GetPlayers()))
end)

game.Players.PlayerRemoving:Connect(function()
    task.wait(0.5)
    playerCountLabel:Set("Players in the server: " .. tostring(#game.Players:GetPlayers()))
end)

-- Dịch vụ
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Players = game:GetService("Players")
local PlaceID = game.PlaceId

local foundAnything = ""

-- Hàm tìm server để teleport (không tránh server cũ)
local function TPReturner()
    local Site
    if foundAnything == "" then
        Site = HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100'))
    else
        Site = HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100&cursor=' .. foundAnything))
    end

    if Site.nextPageCursor and Site.nextPageCursor ~= "null" and Site.nextPageCursor ~= nil then
        foundAnything = Site.nextPageCursor
    else
        foundAnything = ""
    end

    for i,v in pairs(Site.data) do
        if tonumber(v.maxPlayers) > tonumber(v.playing) and tostring(v.id) ~= tostring(game.JobId) then
            local ID = tostring(v.id)
            pcall(function()
                TeleportService:TeleportToPlaceInstance(PlaceID, ID, Players.LocalPlayer)
            end)
            wait(4)
            break
        end
    end
end

-- Vòng lặp tự động hop server với toggle nút
local teleporting = false

local function StartTeleportLoop()
    if teleporting then return end
    teleporting = true

    task.spawn(function()
        while teleporting do
            pcall(function()
                TPReturner()
                if foundAnything ~= "" then
                    TPReturner()
                end
            end)
            task.wait(5)
        end
    end)
end

local function StopTeleportLoop()
    teleporting = false
end

-- Toggle auto hop server
ServerTab:CreateToggle({
    Name = "Auto Hop Server",
    CurrentValue = false,
    Callback = function(Value)
        if Value then
            StartTeleportLoop()
            Rayfield:Notify({
                Title = "Server Hop",
                Content = "Started auto hop!",
                Duration = 4
            })
        else
            StopTeleportLoop()
            Rayfield:Notify({
                Title = "Server Hop",
                Content = "Stopped auto hop.",
                Duration = 4
            })
        end
    end,
})

-- Nút hop thủ công một lần
ServerTab:CreateButton({
    Name = "Hop Server Once",
    Callback = function()
        pcall(function()
            TPReturner()
            if foundAnything ~= "" then
                TPReturner()
            end
        end)
    end,
})

-- Input JobId để join server bất kỳ
ServerTab:CreateInput({
    Name = "Join Server by JobId",
    PlaceholderText = "Paste JobId here",
    RemoveTextAfterFocusLost = false,
    Callback = function(jobId)
        TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, Players.LocalPlayer)
    end
})

-- Nút copy JobId hiện tại
ServerTab:CreateButton({
    Name = "Copy current JobId",
    Callback = function()
        setclipboard(game.JobId)
        Rayfield:Notify({
            Title = "JobId Copied",
            Content = "Copied the JobId of the current server to the clipboard!",
            Duration = 4,
            Image = 6035047409
        })
    end,
})

local SettingTab = Window:CreateTab("Setting")
local antiAfkGui = nil
local antiAfkThread = nil

local function startAntiAfk()
    if antiAfkGui then return end

    -- Đoạn code Anti-AFK của bạn (rút gọn lại cho toggle)
    repeat wait() until game:IsLoaded() and game.Players and game.Players.LocalPlayer and game.Players.LocalPlayer.Character

    if getgenv().AntiAfkExecuted and game.CoreGui:FindFirstChild("thisoneissocoldww") then 
        getgenv().AntiAfkExecuted = false
        getgenv().zamanbaslaticisi = false
        game.CoreGui.thisoneissocoldww:Destroy()
    end

    getgenv().AntiAfkExecuted = true

    -- Tạo GUI
    antiAfkGui = Instance.new("ScreenGui")
    antiAfkGui.Name = "thisoneissocoldww"
    antiAfkGui.Parent = game.CoreGui
    antiAfkGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local madebybloodofbatus = Instance.new("Frame")
    madebybloodofbatus.Name = "madebybloodofbatus"
    madebybloodofbatus.Parent = antiAfkGui
    madebybloodofbatus.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    madebybloodofbatus.Position = UDim2.new(0.085, 0, 0.131, 0)
    madebybloodofbatus.Size = UDim2.new(0, 225, 0, 96)

    local UICornerw = Instance.new("UICorner")
    UICornerw.Parent = madebybloodofbatus

    local DestroyButton = Instance.new("TextButton")
    DestroyButton.Name = "DestroyButton"
    DestroyButton.Parent = madebybloodofbatus
    DestroyButton.BackgroundTransparency = 1
    DestroyButton.Position = UDim2.new(0.87, 0, 0.025, 0)
    DestroyButton.Size = UDim2.new(0, 27, 0, 15)
    DestroyButton.Font = Enum.Font.SourceSans
    DestroyButton.Text = "X"
    DestroyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DestroyButton.TextSize = 14

    DestroyButton.MouseButton1Click:Connect(function()
        getgenv().AntiAfkExecuted = false
        getgenv().zamanbaslaticisi = false
        if antiAfkGui then
            antiAfkGui:Destroy()
            antiAfkGui = nil
        end
    end)

    local uselesslabelone = Instance.new("TextLabel")
    uselesslabelone.Parent = madebybloodofbatus
    uselesslabelone.BackgroundTransparency = 1
    uselesslabelone.Position = UDim2.new(0.3, 0, 0, 0)
    uselesslabelone.Size = UDim2.new(0, 95, 0, 24)
    uselesslabelone.Font = Enum.Font.SourceSans
    uselesslabelone.Text = "Anti Afk V1 By Evxn#6765"
    uselesslabelone.TextColor3 = Color3.fromRGB(255, 255, 255)
    uselesslabelone.TextSize = 14

    local timerlabel = Instance.new("TextLabel")
    timerlabel.Name = "timerlabel"
    timerlabel.Parent = madebybloodofbatus
    timerlabel.BackgroundTransparency = 1
    timerlabel.Position = UDim2.new(0.65, 0, 0.68, 0)
    timerlabel.Size = UDim2.new(0, 60, 0, 24)
    timerlabel.Font = Enum.Font.SourceSans
    timerlabel.Text = "0:0:0"
    timerlabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    timerlabel.TextSize = 14

    -- ... (các label khác, có thể rút gọn nếu không cần)

    -- Kéo frame
    local Drag = madebybloodofbatus
    local UserInputService = game:GetService("UserInputService")
    local TweenService = game:GetService("TweenService")
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        local dragTime = 0.04
        local SmoothDrag = {}
        SmoothDrag.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        local dragSmoothFunction = TweenService:Create(Drag, TweenInfo.new(dragTime, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), SmoothDrag)
        dragSmoothFunction:Play()
    end
    Drag.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = Drag.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    Drag.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging and Drag.Size then
            update(input)
        end
    end)

    -- Anti-AFK logic
    local vu = game:GetService("VirtualUser")
    antiAfkThread = game.Players.LocalPlayer.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        task.wait(1)
        vu:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    end)

    -- Timer
    getgenv().zamanbaslaticisi = true
    spawn(function()
        local saniye, dakika, saat = 0, 0, 0
        while getgenv().zamanbaslaticisi and antiAfkGui do
            wait(1)
            saniye = saniye + 1
            if saniye >= 60 then
                saniye = 0
                dakika = dakika + 1
            end
            if dakika >= 60 then
                dakika = 0
                saat = saat + 1
            end
            timerlabel.Text = string.format("%d:%d:%d", saat, dakika, saniye)
        end
    end)
end

local function stopAntiAfk()
    getgenv().AntiAfkExecuted = false
    getgenv().zamanbaslaticisi = false
    if antiAfkThread then
        antiAfkThread:Disconnect()
        antiAfkThread = nil
    end
    if antiAfkGui then
        antiAfkGui:Destroy()
        antiAfkGui = nil
    end
end

SettingTab:CreateToggle({
    Name = "Anti-AFK",
    CurrentValue = false,
    Callback = function(enabled)
        if enabled then
            startAntiAfk()
        else
            stopAntiAfk()
        end
    end,
})
